<% content_for :title, "Dashboard - Kerouac" %>

<div class="space-y-8">
  <!-- Header -->
  <div class="flex items-center justify-between">
    <div>
      <h1 class="text-xl font-bold text-terminal-bright uppercase tracking-wider">
        &gt; Writing Activity_
      </h1>
      <p class="mt-1 text-sm text-terminal-dim">// Track your publishing streak</p>
    </div>
    <div>
      <%= link_to new_connection_path, class: "btn-primary" do %>
        + ADD CONNECTION
      <% end %>
    </div>
  </div>

  <!-- Stats Grid -->
  <div class="grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-4">
    <!-- Current Streak -->
    <div class="stat-card">
      <dt class="stat-label">Current Streak</dt>
      <dd class="flex items-baseline">
        <span class="stat-value stat-value-highlight animate-pulse-glow"><%= @current_streak %></span>
        <span class="ml-2 text-sm text-terminal-dim">days</span>
      </dd>
    </div>

    <!-- Total Posts -->
    <div class="stat-card">
      <dt class="stat-label">Total Posts</dt>
      <dd class="stat-value"><%= @total_posts %></dd>
    </div>

    <!-- This Week -->
    <div class="stat-card">
      <dt class="stat-label">Posts This Week</dt>
      <dd class="stat-value"><%= @posts_this_week %></dd>
    </div>

    <!-- Total Words -->
    <div class="stat-card">
      <dt class="stat-label">Total Words</dt>
      <dd class="stat-value"><%= number_with_delimiter(@total_word_count) %></dd>
    </div>
  </div>

  <!-- Activity Graph -->
  <div class="card">
    <div class="card-header">Activity Graph</div>
    <div class="card-body" data-controller="activity-graph" data-activity-graph-data-value="<%= @activity_data.to_json %>">
      <div class="mb-4 flex items-center justify-end gap-3">
        <span class="text-xs text-terminal-dim">PNG 1200x675</span>
        <button type="button" class="btn-secondary text-xs cursor-pointer" data-action="activity-graph#exportTwitterImage">
          EXPORT FOR TWITTER
        </button>
      </div>
      <div class="overflow-x-auto pb-2">
        <div data-activity-graph-target="graph" class="activity-graph"></div>
      </div>
      <div class="mt-4 flex items-center justify-end text-xs text-terminal-dim">
        <span class="mr-2">Less</span>
        <div class="flex space-x-1">
          <div class="w-3 h-3 activity-level-0"></div>
          <div class="w-3 h-3 activity-level-1"></div>
          <div class="w-3 h-3 activity-level-2"></div>
          <div class="w-3 h-3 activity-level-3"></div>
          <div class="w-3 h-3 activity-level-4"></div>
        </div>
        <span class="ml-2">More</span>
      </div>
    </div>
  </div>

  <!-- Two Column Layout -->
  <div class="grid grid-cols-1 gap-6 lg:grid-cols-2">
    <!-- Recent Posts -->
    <div class="card">
      <div class="card-header">Recent Posts</div>
      <div class="card-body p-0">
        <% if @recent_posts.any? %>
          <ul class="ascii-list">
            <% @recent_posts.each do |post| %>
              <li class="ascii-list-item">
                <div class="flex items-start justify-between gap-4">
                  <div class="min-w-0 flex-1">
                    <p class="text-sm text-terminal truncate">
                      <% if post.url.present? %>
                        <%= link_to post.title, post.url, target: "_blank", class: "hover:text-terminal-bright" %>
                      <% else %>
                        <%= post.title %>
                      <% end %>
                    </p>
                    <div class="mt-1 flex flex-wrap items-center gap-2 text-xs text-terminal-dim">
                      <span class="badge badge-<%= post.platform %>"><%= post.platform.upcase %></span>
                      <span><%= post.published_at.strftime("%Y-%m-%d") %></span>
                      <% if post.word_count.to_i > 0 %>
                        <span><%= number_with_delimiter(post.word_count) %> words</span>
                      <% end %>
                    </div>
                  </div>
                </div>
              </li>
            <% end %>
          </ul>
        <% else %>
          <div class="empty-state">
            <div class="text-4xl text-terminal-dim mb-4">[ ]</div>
            <h3 class="empty-state-title">No posts yet</h3>
            <p class="empty-state-description">Connect a platform to start tracking your writing.</p>
            <div class="mt-6">
              <%= link_to new_connection_path, class: "btn-primary" do %>
                + ADD CONNECTION
              <% end %>
            </div>
          </div>
        <% end %>
      </div>
    </div>

    <!-- Connections -->
    <div class="card">
      <div class="card-header flex items-center justify-between">
        <span>Connected Platforms</span>
        <%= link_to "VIEW ALL >>", connections_path, class: "text-xs text-terminal-dim hover:text-terminal" %>
      </div>
      <div class="card-body p-0">
        <% if @connections.any? %>
          <ul class="ascii-list">
            <% @connections.each do |connection| %>
              <li class="ascii-list-item">
                <div class="flex items-center justify-between">
                  <div class="flex items-center min-w-0 gap-3">
                    <%= render "connections/platform_icon", platform: connection.platform %>
                    <div class="min-w-0">
                      <p class="text-sm text-terminal truncate"><%= connection.name %></p>
                      <p class="text-xs text-terminal-dim"><%= connection.posts_count %> posts</p>
                    </div>
                  </div>
                  <div>
                    <%= render "connections/status_badge", connection: connection %>
                  </div>
                </div>
              </li>
            <% end %>
          </ul>
        <% else %>
          <div class="empty-state">
            <div class="text-4xl text-terminal-dim mb-4">&lt;/&gt;</div>
            <h3 class="empty-state-title">No connections</h3>
            <p class="empty-state-description">Get started by connecting a writing platform.</p>
            <div class="mt-6">
              <%= link_to new_connection_path, class: "btn-primary" do %>
                + ADD CONNECTION
              <% end %>
            </div>
          </div>
        <% end %>
      </div>
    </div>
  </div>
</div>
