<% content_for :title, "#{@connection.name} - Kerouac" %>

<div class="space-y-6">
  <!-- Header -->
  <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
    <div class="flex items-center gap-4">
      <%= render "connections/platform_icon", platform: @connection.platform %>
      <div>
        <h1 class="text-xl font-bold text-terminal-bright uppercase tracking-wider">
          &gt; <%= @connection.name %>_
        </h1>
        <div class="mt-1 flex items-center gap-3 text-sm">
          <%= render "connections/status_badge", connection: @connection %>
          <span class="text-terminal-dim">
            <%= @connection.platform.upcase %> | <%= @connection.posts_count %> posts
          </span>
        </div>
      </div>
    </div>
    <div class="flex gap-3">
      <%= button_to sync_connection_path(@connection), method: :post, class: "btn-secondary" do %>
        ~ SYNC NOW
      <% end %>
      <%= link_to edit_connection_path(@connection), class: "btn-secondary" do %>
        / EDIT
      <% end %>
    </div>
  </div>

  <% if @connection.last_synced_at.present? %>
    <p class="text-sm text-terminal-dim">// Last synced <%= time_ago_in_words(@connection.last_synced_at) %> ago</p>
  <% end %>

  <% if @connection.error? && @connection.last_error.present? %>
    <div class="flash-alert">
      <strong>Sync Error:</strong> <%= @connection.last_error %>
    </div>
  <% end %>

  <!-- Posts List -->
  <div class="card">
    <div class="card-header">Recent Posts</div>
    <div class="card-body p-0">
      <% if @posts.any? %>
        <ul class="ascii-list">
          <% @posts.each do |post| %>
            <li class="ascii-list-item">
              <div class="flex items-start justify-between gap-4">
                <div class="min-w-0 flex-1">
                  <p class="text-sm text-terminal truncate">
                    <% if post.url.present? %>
                      <%= link_to post.title, post.url, target: "_blank", class: "hover:text-terminal-bright" %>
                    <% else %>
                      <%= post.title %>
                    <% end %>
                  </p>
                  <div class="mt-1 flex flex-wrap items-center gap-2 text-xs text-terminal-dim">
                    <span class="badge badge-<%= post.platform %>"><%= post.post_type.upcase %></span>
                    <span><%= post.published_at.strftime("%Y-%m-%d") %></span>
                    <% if post.word_count.to_i > 0 %>
                      <span><%= number_with_delimiter(post.word_count) %> words</span>
                    <% end %>
                  </div>
                </div>
              </div>
            </li>
          <% end %>
        </ul>
      <% else %>
        <div class="empty-state py-12">
          <p class="text-sm text-terminal-dim">// No posts synced yet</p>
        </div>
      <% end %>
    </div>
  </div>
</div>
