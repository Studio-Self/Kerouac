<% content_for :title, "Connections - Kerouac" %>

<div class="space-y-6">
  <!-- Header -->
  <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
    <div>
      <h1 class="text-xl font-bold text-terminal-bright uppercase tracking-wider">
        &gt; Connections_
      </h1>
      <p class="mt-1 text-sm text-terminal-dim">// Manage your connected writing platforms</p>
    </div>
    <div class="flex gap-3">
      <% if @connections.any? %>
        <%= button_to sync_all_connections_path, method: :post, class: "btn-secondary" do %>
          ~ SYNC ALL
        <% end %>
      <% end %>
      <%= link_to new_connection_path, class: "btn-primary" do %>
        + ADD CONNECTION
      <% end %>
    </div>
  </div>

  <!-- Connections List -->
  <% if @connections.any? %>
    <div class="card">
      <ul class="ascii-list">
        <% @connections.each do |connection| %>
          <li class="ascii-list-item">
            <div class="flex flex-col sm:flex-row sm:items-center gap-4">
              <div class="flex items-center min-w-0 flex-1 gap-3">
                <%= render "connections/platform_icon", platform: connection.platform %>
                <div class="min-w-0 flex-1">
                  <div class="flex items-center gap-2">
                    <p class="text-sm text-terminal truncate font-medium"><%= connection.name %></p>
                    <%= render "connections/status_badge", connection: connection %>
                  </div>
                  <p class="mt-1 text-xs text-terminal-dim">
                    <%= connection.platform.upcase %> |
                    <%= connection.posts_count %> posts
                    <% if connection.last_synced_at.present? %>
                      | synced <%= time_ago_in_words(connection.last_synced_at) %> ago
                    <% end %>
                  </p>
                  <% if connection.error? && connection.last_error.present? %>
                    <p class="mt-1 text-xs text-red-400">[ERR] <%= connection.last_error.truncate(80) %></p>
                  <% end %>
                </div>
              </div>
              <div class="flex items-center gap-2 ml-auto sm:ml-0">
                <%= button_to sync_connection_path(connection), method: :post, class: "btn-icon", title: "Sync" do %>
                  ~
                <% end %>
                <%= link_to edit_connection_path(connection), class: "btn-icon", title: "Edit" do %>
                  /
                <% end %>
                <%= button_to connection_path(connection), method: :delete, data: { turbo_confirm: "Are you sure you want to remove this connection? All synced posts will be deleted." }, class: "btn-icon-danger", title: "Delete" do %>
                  x
                <% end %>
              </div>
            </div>
          </li>
        <% end %>
      </ul>
    </div>
  <% else %>
    <!-- Empty State -->
    <div class="card">
      <div class="empty-state py-16">
        <div class="text-5xl text-terminal-dim mb-4">&lt;/&gt;</div>
        <h3 class="empty-state-title">No connections</h3>
        <p class="empty-state-description">Get started by connecting your first writing platform.</p>
        <div class="mt-6">
          <%= link_to new_connection_path, class: "btn-primary" do %>
            + ADD CONNECTION
          <% end %>
        </div>
      </div>
    </div>
  <% end %>
</div>
