<%= form_with model: connection, local: true, class: "space-y-6" do |f| %>
  <% if connection.errors.any? %>
    <div class="flash-alert">
      <div class="font-bold mb-2"><%= pluralize(connection.errors.count, "error") %> prohibited this connection from being saved:</div>
      <ul class="list-none space-y-1">
        <% connection.errors.each do |error| %>
          <li class="text-sm">- <%= error.full_message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <div>
    <label for="connection_platform" class="form-label">Platform</label>
    <div class="mt-2">
      <%= f.select :platform,
          Connection.platforms.keys.map { |p| [p.upcase, p] },
          { prompt: "-- SELECT PLATFORM --" },
          class: "form-select",
          data: { action: "change->connection-form#platformChanged" } %>
    </div>
  </div>

  <div>
    <label for="connection_name" class="form-label">Name</label>
    <div class="mt-2">
      <%= f.text_field :name, class: "form-input", placeholder: "My Blog" %>
    </div>
    <p class="mt-1 text-xs text-terminal-dim">// A friendly name to identify this connection</p>
  </div>

  <div data-controller="connection-form">
    <div>
      <label for="connection_identifier" class="form-label">Identifier</label>
      <div class="mt-2">
        <%= f.text_field :identifier, class: "form-input", data: { "connection-form-target": "identifier" } %>
      </div>
      <p class="mt-1 text-xs text-terminal-dim" data-connection-form-target="identifierHelp">
        // Enter your platform identifier (username, subdomain, or URL)
      </p>
    </div>

    <div class="mt-6" data-connection-form-target="credentialsSection">
      <label for="connection_credentials" class="form-label">API Credentials</label>
      <div class="mt-2">
        <%= f.text_area :credentials, rows: 3, class: "form-textarea", placeholder: '{"api_key": "your-api-key"}' %>
      </div>
      <p class="mt-1 text-xs text-terminal-dim" data-connection-form-target="credentialsHelp">
        // For Ghost: {"api_url": "https://your-blog.ghost.io", "admin_api_key": "key:secret"}
      </p>
    </div>
  </div>

  <div class="flex items-center justify-end gap-4 pt-6 border-t border-terminal-dim">
    <%= link_to "[ CANCEL ]", connections_path, class: "text-sm text-terminal-dim hover:text-terminal" %>
    <%= f.submit class: "btn-primary cursor-pointer" %>
  </div>
<% end %>
